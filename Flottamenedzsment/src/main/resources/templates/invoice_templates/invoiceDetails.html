<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/main}">
<head>
<title>Flotta</title>
</head>
<body>

  <div layout:fragment="loginContent">
  
    <h3 class="uppercase" th:text="#{invoiceDetails}">Invoice details</h3>
  
    <h4 class="uppercase" th:text="#{invoice.sender}">Sender</h4>

    <div class="row my-2">
      <div class="col-2">
        <label th:text="#{name}">Company name</label>
      </div>
      <div class="col-2 text-right">
        <label th:text="${invoice.company.name}"></label>
      </div>
    </div>
    <div class="row my-2">
      <div class="col-2">
        <label th:text="#{participant.address}">Address</label>
      </div>
      <div class="col-2 text-right">
        <label th:text="${invoice.company.address}"></label>
      </div>
    </div>

    <h4 class="uppercase" th:text="#{invoiceSummary}">Invoice summary</h4>

    <div class="row my-2">
      <div class="col-2">
        <label th:text="#{invoice.invoiceNumber}">Invoice number</label>
      </div>
      <div class="col-2 text-right">
        <label th:text="${invoice.invoiceNumber}">Invoice number</label>
      </div>
    </div>
    <div class="row my-2">
      <div class="col-2">
        <label th:text="#{invoice.periodBegin}">Period begin</label>
      </div>
      <div class="col-2 text-right">
        <label th:text="${invoice.beginDate}">Begin date</label>
      </div>
    </div>
    <div class="row my-2">
      <div class="col-2">
        <label th:text="#{invoice.periodEnd}">Period end</label>
      </div>
      <div class="col-2 text-right">
        <label th:text="${invoice.endDate}">End date</label>
      </div>
    </div>
    <div class="row my-2">
      <div class="col-2">
        <label th:text="#{invoice.netAmount}">Net amount</label>
      </div>
      <div class="col-2 text-right">
        <label th:text="${invoice.netAmount} + ' Ft'">Net amount</label>
      </div>
    </div>
    <div class="row my-2">
      <div class="col-2">
        <label th:text="#{invoice.taxAmount}">Tax amount</label>
      </div>
      <div class="col-2 text-right">
        <label th:text="${invoice.taxAmount} + ' Ft'">Tax amount</label>
      </div>
    </div>

    <h4 class="uppercase" th:text="#{invoiceDetails}">Invoice details</h4>

    <div th:each="partOfInvoice : ${invoice.invoicePart}">
      <a class="noneunderline"
        th:href="'#' + ${partOfInvoice.subscription?.number} + ${partOfInvoice.user != null ? partOfInvoice.user.fullName : 'Company'}"
        data-toggle="collapse" aria-expanded="false" role="button" onclick="change(this)"
      >
      
        <table class="table table-sm">
          <thead>
            <tr>
              <td th:text="${partOfInvoice.subscription?.number} + ' - ' + (${partOfInvoice.user != null} ? ${partOfInvoice.user.fullName} : #{company})" style="width: 80%"></td>
              <td th:text="${#numbers.formatDecimal(partOfInvoice.grossAmount, 1, 2)} + ' Ft'"></td>
              <td class="text-right">
                <button class="btn btn-sm" style="background-color: transparent;">
                  <img src="/img/down-arrow.png" alt="down-arrow" />
                </button>
              </td>
            </tr>
          </thead>
          <tbody th:if="${partOfInvoice.hasReviewNote()}">
            <tr class="hasReviewNote">
              <td th:colspan="${partOfInvoice.acceptedByCompany or partOfInvoice.user == null} ? 5 : 6" th:text="${partOfInvoice.reviewNote}"></td>
            </tr>
          </tbody>
        </table>
      </a>
      <div
        th:id="${partOfInvoice.subscription?.number} + ${partOfInvoice.user != null ? partOfInvoice.user.fullName : 'Company'}"
        class="collapse" style="margin-left: 15px; margin-right: 15px;"
      >
        <table class="table table-sm">
          <thead>
            <tr>
              <th th:text="#{description}">Description</th>
              <th class="text-center" th:text="#{period}">Period</th>
              <th class="text-right" th:text="#{invoice.grossAmount}">Gross amount</th>
              <th class="text-right" th:text="#{user}">User</th>
              <th class="text-right" th:text="#{company}">Company</th>
              <th th:unless="${partOfInvoice.acceptedByCompany or partOfInvoice.user == null}"></th>
            </tr>
          </thead>
          <tbody th:each="feeItem : ${partOfInvoice.feeItems}" >
              <tr th:id="'feeItem' + ${feeItem.id}" th:classappend=" ${feeItem.hasReviewNote()} ? 'hasReviewNote' :''">
                <td name="description" th:text="${feeItem.description}"></td>
                <td class="text-center" name="period" th:text="${feeItem.getPeriod()}"></td>
                <td class="text-right" name="totalGrossAmount"
                  th:text="${#numbers.formatDecimal(feeItem.grossAmount, 1, 2)} + ' Ft'"
                ></td>
                <td class="text-right" name="userGrossAmount"
                  th:text="${#numbers.formatDecimal(feeItem.userGrossAmount, 1, 2)} + ' Ft'"
                ></td>
                <td class="text-right" name="compGrossAmount"
                  th:text="${#numbers.formatDecimal(feeItem.companyGrossAmount, 1, 2)} + ' Ft'"
                ></td>
                <td name="buttons" width="85px" th:unless="${partOfInvoice.acceptedByCompany or partOfInvoice.user == null}">
                  <div id="prepareEditingButton" class="text-center">
                    <button type="button" class="btn btn-primary" onclick="prepare_editing(this)" th:text="#{button.edit}">
                    </button>
                  </div>
                  <div id="acceptOrCancelEditingButton" style="display: none" class="text-center">
                    <button type="button" class="btn btn-success" onclick="accept_editing(this)">
                      <img th:alt="#{button.accept}" src="/img/checkmark.png">
                    </button>
                    <button type="button" class="btn btn-danger" onclick="cancel_editing(this)">
                      <img th:alt="#{button.cancel}" src="/img/cross.png">
                    </button>
                  </div>
                </td>
              </tr>
              <tr th:if="${feeItem.hasReviewNote()}" class="hasReviewNote">
                <td th:text="${feeItem.reviewNote}" th:colspan="${partOfInvoice.acceptedByCompany or partOfInvoice.user == null} ? 5 : 6"></td>
              </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="text-right">
      <a href="/invoice/all" class="btn btn-primary" th:text="#{button.back}">Back</a>
    </div>
    

    <script src="/js/invoice/invoiceDetails.js"></script>


  </div>
</body>
</html>