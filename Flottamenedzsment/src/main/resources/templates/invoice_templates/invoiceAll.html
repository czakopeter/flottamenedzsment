<!DOCTYPE html>
<html lang="en" layout:decorate="~{layouts/main}">
<head>
<title>Flotta</title>
</head>
<body>

  <div layout:fragment="loginContent">

    <h3 th:text="#{main.invoices}">Invoices</h3>

    <div
      th:replace="fragments/filter/filter :: add-and-filter-wrapper(invoice-upload, invoice-filter-options)"
    ></div>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div>
      <h4 th:text="#{rawInvoices}">Raw invoices</h4>

      <form method="post">
        <table id="raw-invoice-table" class="table table-sm">
          <thead>
            <tr>
              <th th:text="#{invoice.invoiceNumber}">Invoice number</th>
              <th th:text="#{invoice.from}">From</th>
              <th th:text="#{invoice.to}">To</th>
              <th th:text="#{invoice.netAmount}">Net amount</th>
              <th th:text="#{invoice.grossAmount}">Gross amount</th>
              <th></th>
            </tr>
          </thead>
          <tbody name="content-body">
            <tr th:each="rawInvoice : ${rawInvoices}"
              th:id="'invoiceNumber' + ${rawInvoice.invoiceNumber}"
            >
              <td name="invoiceNumber" th:text="${rawInvoice.invoiceNumber}"></td>
              <td name="beginDate" th:text="${rawInvoice.beginDate}"></td>
              <td name="endDate" th:text="${rawInvoice.endDate}"></td>
              <td th:text="${rawInvoice.invoiceNetAmount}"></td>
              <td th:text="${rawInvoice.invoiceGrossAmount}"></td>
              <td class="text-right"><a th:if="${rawInvoice.hasProblem()}" href="#"
                class="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true"
                aria-expanded="false"
              ><b>...</b></a>
                <div class="dropdown-menu">
                  <button type="submit" class="dropdown-item"
                    th:formaction="'/invoice/' + ${rawInvoice.invoiceNumber} + '/restartProcessing'"
                    th:text="#{button.restartProcessing}"
                  >Restart processing</button>
                  <span class="dropdown-item" th:each="problem : ${rawInvoice.getProblems()}"
                    th:text="${problem}"
                  ></span>
                  <button type="button" class="dropdown-item" onclick="sendRawRemove(this)"
                    th:text="#{button.delete}"
                  >Delete</button>
                </div></td>
            </tr>
          </tbody>
          <tbody name="no-element-body"
            th:classappend="${#lists.isEmpty(rawInvoices)} ? '' : 'collapse'"
          >
            <tr>
              <th colspan="6" th:text="#{noElement}">No element</th>
            </tr>
          </tbody>
        </table>
      </form>
    </div>



    <div>

      <h4 th:text="#{invoices}">Invoices</h4>

      <table id="invoice-table" class="table table-sm">
        <thead>
          <tr>
            <th th:text="#{invoice.invoiceNumber}">Invoice number</th>
            <th th:text="#{invoice.from}">From</th>
            <th th:text="#{invoice.to}">To</th>
            <th th:text="#{invoice.netAmount}">Net amount</th>
            <th th:text="#{invoice.grossAmount}">Gross amount</th>
            <th></th>
          </tr>
        </thead>
        <tbody name="content-body">
          <tr th:id="'invoiceNumber' + ${invoice.invoiceNumber}" th:each="invoice : ${invoices}"
            th:classappend="${invoice.hasAnyRevisionNote() ? 'hasRevisionNote' : ''}"
          >
            <td name="invoiceNumber" th:text="${invoice.invoiceNumber}"></td>
            <td name="beginDate" th:text="${invoice.beginDate}"></td>
            <td name="endDate" th:text="${invoice.endDate}"></td>
            <td th:text="${invoice.invoiceNetAmount}"></td>
            <td th:text="${invoice.invoiceGrossAmount}"></td>
            <td class="text-right">
              <button name="acceptBtn" th:unless="${invoice.acceptedByCompany}" type="button" class="btn btn-sm btn-success"
                onclick="acceptInvoiceByCompany(this)"
              >
                <img th:alt="#{button.accept}" src="/img/checkmark.png">
              </button>
              <a th:href="'/invoice/' + ${invoice.invoiceNumber} + '/details'"
                class="btn btn-sm btn-primary"
                > 
                <img th:alt="#{button.details}" src="/img/list.png" />
              </a>
              <button name="deleteBtn" th:if="${invoice.canDelete()}" type="button" class="btn btn-sm btn-danger"
                onclick="deleteInvoice(this)" 
              >
                <img th:alt="#{button.delete}" src="/img/trash.png" />
              </button>
            </td>
          </tr>
        </tbody>
        <tbody name="no-result-body" class="collapse">
          <tr>
            <td colspan="6" th:text="#{noResult}">No result</td>
          </tr>
        </tbody>
        <tbody name="no-element-body" th:classappend="${#lists.isEmpty(invoices)} ? '' : 'collapse'">
          <tr>
            <th colspan="6" th:text="#{noElement}">There aren't any elements</th>
          </tr>
        </tbody>
      </table>
    </div>


    <script src="/js/invoice/invoiceAll.js"></script>



  </div>
</body>
</html>